<!DOCTYPE html>
<html lang="es">

<head>
  <!-- Meta -->
  <title>Metaverso</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
  <meta property="og:title" content="Metaverso" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="gray-translucent" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@AdaRoseCannon" />
  <meta name="twitter:creator" content="@AdaRoseCannon" />
  <meta property="og:url" content="https://www.nomaddi.com/" />
  <meta name="description" content="Metaverso Inandina, 2023." />
  <meta property="og:description" content="A sample scene for working with WebXR Hand Tracking" />
  <meta property="og:image" content="https://www.inandina.edu.co/wp-content/uploads/2021/04:/Logo-Nomaddi.png" />

  <script>
    // WebXR requiere https: para funcionar, así que me aseguro de ser redirigido si es necesario.
    if (location.hostname !== 'localhost' && window.location.protocol === 'http:') window.location.protocol = 'https:';
  </script>

  <!-- la biblioteca AFrame y componentes de terceros -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe-master.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/components/sphere-collider.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.controls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/physx@v0.1.0/dist/physx.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls@0.4.3/dist/aframe-blink-controls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.10/build/handy-controls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.10/build/magnet-helpers.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-htmlmesh@2.0.1/build/aframe-html.min.js"></script>
  <script src="ar-cursor.js"></script>
  <script src="simple-navmesh-constraint.js"></script>
  <script src="model-utils.js"></script>

  <!-- conexiones para multijugador -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.4.0/socket.io.slim.js"></script>
  <script src="../easyrtc/easyrtc.js"></script>
  <script src="../dist/networked-aframe.js"></script>

  <!-- iconos -->
  <script src="https://kit.fontawesome.com/ecf199e124.js" crossorigin="anonymous"></script>

  <!-- particulas -->
  <script src="../js/aframe-particle-system-component.min.js"></script>

  <!-- Aparecer random -->
  <script src="../js/spawn-in-circle.component.js"></script>


  <!-- objetos online -->
  <script src="../js/online.js"></script>


  <!-- botones -->
  <script src="../js/botones.js"></script>

  <!-- click con pc -->
  <script src="../js/highlight.js"></script>

  <!-- informacio -->
  <script src="../js/info-panel.js"></script>

  <!-- redireccionamiento -->
  <script src="../js/url.js"></script>





  <!-- comportamiento personalizado -->
  <script src="main.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <a-scene stats loading-screen="enabled:false" id="scene-vr" networked-scene="
        room: Metaverso;
        debug: true;
        adapter: easyrtc;
        audio: true;
        video: false;" cursor="rayOrigin: mouse; fuse: false"
    physx="autoLoad: true; delay: 1000; wasmUrl: https://cdn.jsdelivr.net/gh/c-frame/physx@v0.1.0/wasm/physx.release.wasm; useDefaultScene: false;"
    webxr="overlayElement:#dom-overlay;" background="color:skyblue;"
    renderer="antialias:true;highRefreshRate:true;alpha:true;physicallyCorrectLights:true;colorManagement:true;exposure:2;toneMapping:ACESFilmic;"
    raycaster="objects: .raycastable, .clickable" shadow="type: pcfsoft"
    gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/versioned/decoders/1.5.6/;" ar-cursor>

    </a-entity>
    <a-assets>
      <a-asset-item id="building-glb" src="../assets/gltf-Jhon/metaverso.glb"></a-asset-item>
      <a-asset-item id="navmesh-glb" src="../assets/gltf-Jhon/mesh.glb"></a-asset-item>
      <a-asset-item id="chair" src="../assets/gltf-Jhon/chair.glb"></a-asset-item>
      <a-asset-item id="right-gltf"
        src="https://vazxmixjsiawhamofees.supabase.co/storage/v1/object/public/models/skeleton-right-hand-webxr/model.gltf"></a-asset-item>
      <a-asset-item id="left-gltf"
        src="https://vazxmixjsiawhamofees.supabase.co/storage/v1/object/public/models/skeleton-left-hand-webxr/model.gltf"></a-asset-item>
      <a-asset-item id="watch-gltf"
        src="https://cdn.glitch.global/d29f98b4-ddd1-4589-8b66-e2446690e697/watch.glb?v=1645016979219"></a-asset-item>
      <a-asset-item id="stew-gltf"
        src="https://cdn.glitch.global/d29f98b4-ddd1-4589-8b66-e2446690e697/vintage_grandfather_clock_01_1k-v2.glb?v=1647265174189"></a-asset-item>
      <a-asset-item id="table-gltf"
        src="https://cdn.glitch.global/d29f98b4-ddd1-4589-8b66-e2446690e697/small_wooden_table_01_1k-v1.glb?v=1647263187998"></a-asset-item>
      <a-asset-item id="ladder-gltf"
        src="https://cdn.glitch.global/d29f98b4-ddd1-4589-8b66-e2446690e697/ladder.glb?v=1648465045608"></a-asset-item>
      <a-mixin id="animations"
        animation__click="property: components.material.material.color; type: color; to: blue; startEvents: click; dur: 500;"></a-mixin>
      <!--
          Image source: http://www.ghibli.jp/works/kazetachinu/#frame&gid=1&pid=1
          Image author: Studio Ghibli
        -->
      <img id="kazetachinu" src="https://cdn.aframe.io/examples/ui/kazetachinu.jpg" crossorigin="anonymous" />
      <img id="kazetachinuPoster" src="https://cdn.aframe.io/examples/ui/kazetachinuPoster.jpg"
        crossorigin="anonymous" />
      <!--
          Image source: http://www.ghibli.jp/works/ponyo/#frame&gid=1&pid=36
          Image author: Studio Ghibli
        -->
      <img id="ponyo" src="https://cdn.aframe.io/examples/ui/ponyo.jpg" crossorigin="anonymous" />
      <img id="ponyoPoster" src="https://cdn.aframe.io/examples/ui/ponyoPoster.jpg" crossorigin="anonymous" />
      <!--
          Image source: http://www.ghibli.jp/works/karigurashi/#frame&gid=1&pid=32
          Image author: Studio Ghibli
        -->
      <img id="karigurashi" src="https://cdn.aframe.io/examples/ui/karigurashi.jpg" crossorigin="anonymous" />
      <img id="karigurashiPoster" src="https://cdn.aframe.io/examples/ui/karigurashiPoster.jpg"
        crossorigin="anonymous" />
      <!-- img-360 -->
      <img id="img360" src="../assets/360/jhon-360/forest.png">
      <img id="motos" src="../assets/360/jhon-360/motos.jpg">

      <!-- archivos para el reproductor -->
      <img crossorigin="anonymous" src="../assets/img/play2.png" id="play">
      <img crossorigin="anonymous" src="../assets/img/pause.png" id="pause">
      <img crossorigin="anonymous" src="../assets/img/volume-normal.png" id="volume-normal">
      <img crossorigin="anonymous" src="../assets/img/volume-mute.png" id="volume-mute">
      <img crossorigin="anonymous" src="../assets/img/seek-back.png" id="seek-back">
      <!-- imagenes normales -->
      <img crossorigin="anonymous" id="artwork1" src="../assets/img/inandina.jpg">
      <video id="video1" src="../assets/video/VRpitch.mp4"></video>
      <!-- fin -->
      <a-mixin id="marble" geometry="primitive: sphere" scale=".30 .30 .30"
        animation__rotation="startEvents: mouseenter; pauseEvents: mouseleave; resumeEvents: mouseenter; property: rotation; to: 0 360 0; loop: true; dur: 10000"
        animation__mouseenter="startEvents: mouseenter; pauseEvents: mouseleave; resumeEvents: mouseenter; property: components.material.material.color; type: color; to: white;  dur: 500; "
        animation__mouseleave="property: components.material.material.color; type: color; to: gray; startEvents: mouseleave; dur: 500;"
        shadow></a-mixin>
      <a-mixin id="spin" animation="property: rotation; to: 0 360 0; loop: true; dur: 100000; easing: linear"></a-mixin>

      <a-mixin id="blink"
        blink-controls="button:grip;rotateOnTeleport:false;cameraRig: #cameraRig; teleportOrigin: #head; collisionEntities:.navmesh;"></a-mixin>

      <a-mixin id="handle-visual" geometry="width:0.05;height:0.05;depth:0.2"></a-mixin>
      <!-- mixin para imagenes -->
      <a-mixin id="frame" geometry="primitive: plane; width: 0.5783552; height: 0.8192"
        material="color: white; shader: flat"
        animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter"
        animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"></a-mixin>
      <a-mixin id="poster" geometry="primitive: plane; width: 0.544768; height: 0.786432"
        material="color: white; shader: flat" material="shader: flat" position="0 0 0.005"></a-mixin>
      <a-mixin id="movieImage" geometry="primitive: plane; width: 1.5; height: 0.81"
        material="src: #ponyo; shader: flat; transparent: true" position="0 0.495 0.002"></a-mixin>
      <!-- Templates -->
      <!-- As a substitution for a proper avatar we just use a robot head and hands for now -->
      <a-asset-item id="RobotHead" src="../assets/gltf/avatarHead.glb"></a-asset-item>
      <!-- Avatar -->
      <template id="rig-template">
        <a-entity networked-audio-source></a-entity>
      </template>

      <template id="head-template">
        <a-entity class="cam" gltf-model="#RobotHead" scale="1 1 1"></a-entity>
      </template>
      <!-- /Templates -->
    </a-assets>




    <a-entity id="cameraRig" simple-navmesh-constraint="navmesh:.navmesh;fall:0.5;height:0;exclude:.navmesh-hole;"
      networked="template:#rig-template;attachTemplateToLocal:true;" movement-controls="speed:0.2;camera:#head;"
      position="8.333 0.308 16.392" rotation="0 45 0">
      <!-- camera -->
      <a-entity id="head" camera="near:0.01;" look-controls="pointerLockEnabled: false; touchEnabled: true;"
        position="0 1.65 0" networked="template:#head-template;" visible="true"
        sphere-collider='radius:0.440'></a-entity>

      <a-entity id="leftHand" data-left="ray" mixin="blink" data-no-magnet laser-controls="hand: left"
        raycaster="objects: .raycastable, .clickable, [html];showLine:false;">
        <a-entity html="html:#my-interface;cursor:#cursor" position="-0.142 -0.0166 -0.02928" rotation="-80 90 0"
          scale="0.7 0.7 0.7"></a-entity>
      </a-entity>
      <a-entity id="rightHand" data-right="ray" mixin="blink" data-no-magnet laser-controls="hand: right"
        raycaster="objects: .clickable, .raycastable, [html];far:0.3;showLine:false;lineColor:black;"
        line="color: #118A7E"></a-entity>

    </a-entity>
    <!-- portales -->
    <a-link id="portal-1" href="forest.html" class="raycastable" image="#img360" scale="1.5 1.5 1.5"
      position="11.834 2.442 33.401" rotation="0 25.010 0" link="titleColor:black;title:Forest"></a-link>
    <a-link id="portal-2" href="https://mm18cendales.github.io/proyecto1/" class="raycastable" image="#motos"
      scale="1.5 1.5 1.5" position="-1.408 2.052 -2.651" rotation="0 64.880 0"
      link="title:Motos"></a-link>

    <!-- ejemplo de objetos que no se traspasan"Dusty Piano" (https://skfb.ly/66EPx) by Vincent074 is licensed under Creative Commons Attribution (http://creativecommons.org/licenses/by/4.0/). -->
    <a-gltf-model id="piano" position="-6 0 20.610" rotation="0 196.300 0" shadow="receive:false;cast:true;"
      src="https://cdn.glitch.global/d29f98b4-ddd1-4589-8b66-e2446690e697/piano.glb?v=1644414775118">
      <a-plane rotation="-90 0 0" width="1.5" height="0.6" class="navmesh-hole" visible="false"></a-plane>
    </a-gltf-model>

    <!-- galeria -->
    <a-entity id="background" position="-12.722 1.600 14.900" geometry="primitive: sphere; radius: 20.0"
      material="color: red; side: back; shader: flat" scale="0.001 0.001 0.001" visible="false" class="raycastable">
    </a-entity>
    <a-entity position="-12.722 1.6 14.900" camera
      look-controls="magicWindowTrackingEnabled: false; touchEnabled: false; mouseEnabled: false">
      <a-entity id="fadeBackground" geometry="primitive: sphere; radius: 60.0"
        material="side: back; shader: flat; transparent: true; opacity: 0.6" visible="false">
      </a-entity>
    </a-entity>
    <a-entity id="ui" position="-11.375 2.313 17.327" rotation="0 115.888 0" scale="2 2 2">
      <!-- Poster menu -->
      <a-entity id="menu" highlight>
        <a-entity id="karigurashiButton" position="-0.8 0 0" mixin="frame" class="raycastable menu-button">
          <a-entity material="src: #karigurashiPoster;" mixin="poster"></a-entity>
        </a-entity>

        <a-entity id="kazetachinuButton" position="0 0 0" mixin="frame" class="raycastable menu-button">
          <a-entity material="src: #kazetachinuPoster" mixin="poster"></a-entity>
        </a-entity>

        <a-entity id="ponyoButton" position="0.8 0 0" mixin="frame" class="raycastable menu-button">
          <a-entity material="src: #ponyoPoster" mixin="poster"></a-entity>
        </a-entity>
      </a-entity>
      <!-- Info panel of the selected movie. -->
      <a-entity id="infoPanel" position="0 0 0.5" info-panel visible="false" scale="0.001 0.001 0.001"
        geometry="primitive: plane; width: 1.5; height: 1.8" material="color: #333333; shader: flat; transparent: false"
        class="raycastable">
        <a-entity id="ponyoMovieImage" mixin="movieImage" material="src: #ponyo" visible="false"></a-entity>
        <a-entity id="kazetachinuMovieImage" mixin="movieImage" material="src: #kazetachinu" visible="false"></a-entity>
        <a-entity id="karigurashiMovieImage" mixin="movieImage" material="src: #karigurashi" visible="false"></a-entity>
        <a-entity id="movieTitle" position="-0.68 -0.1 0"
          text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white; value: Ponyo (2003)"></a-entity>
        <a-entity id="movieDescription" position="-0.68 -0.2 0"
          text="baseline: top; shader: msdf; anchor: left; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white; value: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."></a-entity>
      </a-entity>
    </a-entity>
    <!-- fin galeria -->

    <!-- cuadros -->
    <!-- <a-plane id="artworkPosition1" class="clickable" position="-15.538 1.9 0.059" scale="5 5 5" rotation="0 90 0" material="src: #artwork1; color: white; transparent: true; side: double" geometry="" onclick="openInNewTab('https://www.inandina.edu.co/')"></a-plane> -->
    <a-curvedimage id="artworkPosition1" class="clickable" onclick="openInNewTab('https://www.inandina.edu.co/')"
      src="#artwork1" height="3.0" radius="17.960" theta-length="43.410" rotation="0 207.610 0"
      position="-3.030 2.399 7.632" scale="0.520 0.800 0.800"></a-curvedimage>

    <a-curvedimage src="#video1" id="video-screen" height="3.0" radius="8.780" theta-length="66.070"
      rotation="0 4.422 0" position="7.664 2.567 13.723" scale="0.520 0.800 0.800">
      <!-- reproductor -->
      <a-entity id="movieScreenControls" position="2.592 -2.971 3.863" rotation="0 -144.840 0" scale="1.5 1.5 1">
        <!-- Controls for display of video screen, seems to work nicely, javascript below </scene> tag below -->

        <!-- MEDIAS HOLDER -->
        <a-sound id="alert-sound" src="src: url(../assets/wav/action.wav)" autoplay="false" position="0 0 0"></a-sound>

        <!-- CONTROLS -->
        <a-image class="clickable" id="control-back" width="0.4" height="0.4" src="#seek-back"
          position="-0.42425 0.565 -3.47602" rotation="0 1.2570694025170261 0" visible="false"
          scale="0.85 0.85 0.85"></a-image>
        <a-image class="clickable" id="control-play" width="0.4" height="0.4" src="#play"
          position="-0.00457 0.565 -3.47602" rotation="0 1.2570694025170261 0"></a-image>
        <a-image class="clickable" id="control-volume" width="0.4" height="0.4" src="#volume-mute"
          position="0.38786 0.565 -3.47602" rotation="0 1.2570694025170261 0" visible="false"
          scale="0.75 0.75 0.75"></a-image>
        <!-- END CONTROLS -->

        <!-- PROGRESSBAR -->
        <a-entity id="progress-bar" geometry="primitive:plane;height:0.1;width:4"
          material="opacity:0;transparent:true;visible:false" position="-0.00457 0.835 -3.47602"
          rotation="0 1.2570694025170261 0">
          <a-plane id="progress-bar-track" width="4" height="0.1" color="gray" position="" opacity="0.2" material=""
            visible="false" geometry=""></a-plane>
          <a-plane id="progress-bar-fill" width="2.496982785433659" height="0.1" color="#7198e5"
            position="-0.7515086072831705 0 0" geometry="" visible="false" material=""></a-plane>
        </a-entity>
        <!-- END PROGRESSBAR -->

      </a-entity></a-curvedimage>



    <a-entity id="objetos" rotation="0 -50 0" position="0 0 0" hide-on-enter-ar>
      <a-gltf-model id="table" shadow="receive:true;" src="#table-gltf" position="-1.670 0 -0.211"
        rotation="0 140.000 0" scale="1.5 1.5 1.5" physx-body-from-model="type: static;">
      </a-gltf-model>
      <!-- Button test -->
      <a-box position="-1.645 0.893 -0.194" rotation="0 8.880 0" width="0.2" height="0.2" depth="0.2" color="grey"
        animation__press="startEvents:press;property:components.material.material.color;type:color;to:green;dur:100;"
        animation__release="startEvents:release;property:components.material.material.color;type:color;to:grey;dur:100;">
        <a-entity position="0 0.12 0"
          linear-constraint="target:[data-no-magnet];axis:0 1 0;min:0;max:0.18;radius:0.1;useFixedValueIfOutOfRange:true;valueIfOutOfRange:0.18;downEventName:press;downEventThreshold:0;upEventName:release;upEventThreshold:0.18;">
          <a-cylinder radius="0.09" height="0.2" position="0 -0.1 0" color="hotpink"></a-cylinder>
        </a-entity>
      </a-box>
    </a-entity>
    <a-entity light="type: ambient; color: #BBB"></a-entity>

    <a-gltf-model class="navmesh" src="#navmesh-glb" visible="false" position="-28.428 1.248 -29.278"
      rotation="0 -48.400 0"></a-gltf-model>
    <a-gltf-model src="#building-glb" id="building" depthwrite="true" window-replace="Glass" light="intensity: 5.0"
      shadow="cast:false;receive:true;" position="-28.428 1.248 -29.278" rotation="0 -48.400 0"></a-gltf-model>

    <a-sphere color="black" radius="0.005" id="cursor" material="shader:flat" visible="false"></a-sphere>

    <a-entity environment="preset: forest; lightPosition:0 46 0" position="8.469 -0.373 16.759" rotation="0 -2.780 0"
      material="shader: flat;"></a-entity>

    <!-- sillas -->
    <a-gltf-model id="silla" shadow="receive:true;" src="#chair" position="32.71868 1.23537 23.02413" rotation="0 135 0"
      scale="0.013 0.013 0.013" foo>
    </a-gltf-model>

  </a-scene>
  <!-- audio -->
  <audio id="playAudio" autoplay loop>
    <source src="../assets/mp3/oceanSound.mp3" type="audio/mpeg">
  </audio>
  <div id="dom-overlay">
    <!-- titulo -->
    <!-- <div id="splash">
      <div class="loading"></div>
      <div class="start-button">
        <Font color="limegreen">Metaverso Inandina</Font>
      </div>
    </div> -->
    <section
      style="display: inline-block; background: lavenderblush; color: #333333; border-radius: 1em; padding: 1em; margin:0; accent-color: hotpink; position: fixed; bottom: 60px; left: 2px;"
      id="my-interface">
      <h2>Opciones</h2>
      <fieldset style="border:none;">
        <legend>Movimientos</legend>
        <input onclick="toggleThumbstick(this)" type="radio" id="thumbstick-teleport" name="thumbstick" value="teleport"
          checked><label for="thumbstick-teleport"> Saltar</label>
        <input onclick="toggleThumbstick(this)" type="radio" id="thumbstick-move" name="thumbstick" value="move"><label
          for="thumbstick-move"> Caminar</label>
      </fieldset>
      <fieldset style="border:none;">
        <legend>Configuración</legend>
        <div class="button-container">
          <button id="mic-btn" type="button" class="button">
            <i class="fas fa-microphone"></i>
          </button>
          <button id="muteButton" type="button" class="button">
            <i class="fas fa-volume-down"></i>
          </button>
          <button onclick="AFRAME.scenes[0].exitVR()">
            salir
          </button>
        </div>
      </fieldset>
    </section>
    <div class="overlay-footer">


      <!-- HTML form logic -->
      <script>
        let movementType = 'teleport';
        function toggleThumbstick(detail) {
          const rayPointers = ['[data-right="ray"]', '[data-left="ray"]'].map(s => document.querySelector(s));
          const type = detail.value;
          movementType = type;
          if (type === 'move') {
            cameraRig.setAttribute('movement-controls', 'enabled', true);
            for (const p of rayPointers) p.removeAttribute('mixin');
          }
          if (type === 'teleport') {
            cameraRig.setAttribute('movement-controls', 'enabled', false);
            for (const p of rayPointers) p.setAttribute('mixin', 'blink');
          }
        }
        // If the user is teleporting disable movement-controls in XR
        const sceneEl = document.querySelector("a-scene");
        sceneEl.addEventListener("enter-vr", function () {
          if (movementType === 'teleport') {
            cameraRig.setAttribute('movement-controls', 'enabled', false);
          }
        });
        sceneEl.addEventListener("exit-vr", function () {
          cameraRig.setAttribute('movement-controls', 'enabled', true);
        });
      </script>
      <div id="dom-overlay-message">Iniciar VR</div>
    </div>
  </div>

  <!-- reproductor-->
  <script src="../js/video.js"></script>
  <!-- sentarse -->
  <script src="down.js"></script>

</body>

</html>